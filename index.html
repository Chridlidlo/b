<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Répétition Théâtre: L'Homme de la situation</title>
    <!-- Chargement de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Configuration de la police Inter et thème sombre */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1f2937; /* Gris foncé */
        }

        /* Classes de base pour les répliques */
        .line-container {
            min-height: 150px; /* Assure une hauteur minimale pour la lisibilité mobile */
            transition: all 0.3s ease-in-out;
        }
        
        /* Style pour les répliques du partenaire (gris foncé) */
        .actor-line {
            background-color: #374151; /* Gris plus clair */
            color: #d1d5db; /* Texte blanc-gris */
        }

        /* Style pour la réplique à jouer par l'utilisateur (vert éclatant) */
        .user-prompt {
            background-color: #10b981; /* Vert émeraude */
            color: #1f2937; /* Texte très sombre sur fond clair */
            cursor: pointer;
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
        }

        /* Style de la réplique révélée (Jaune pour 'Triche !') */
        .revealed-line {
            background-color: #fcd34d; /* Jaune */
            color: #1f2937;
            font-style: italic;
        }

        /* Style des boutons d'action */
        #rehearsalActions button {
            transition: background-color 0.15s, transform 0.15s, opacity 0.15s;
        }
    </style>
</head>
<body>

    <div id="app" class="p-4 sm:p-8 max-w-2xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-white mb-2">L'HOMME DE LA SITUATION</h1>
            <!-- Affichage du rôle choisi -->
            <h2 id="currentRoleDisplay" class="text-xl text-gray-400">Rôle ciblé : Non sélectionné</h2>
        </header>

        <!-- Zone 1: Authentification (Visible au début) -->
        <div id="authArea" class="bg-gray-800 p-6 rounded-xl shadow-2xl mb-6">
            <label for="firstNameInput" class="block text-white text-lg font-semibold mb-3">Veuillez entrer votre prénom pour démarrer la répétition :</label>
            <input type="text" id="firstNameInput" class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Ex: Christophe">
            
            <button id="authButton" onclick="checkAuthorization()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition duration-150 shadow-lg w-full mt-4 active:scale-95">
                Accéder à la Sélection de Rôle
            </button>
            <p id="authMessage" class="text-red-400 mt-3 hidden"></p>
        </div>

        <!-- Zone 2: Sélection du Rôle (Visible après l'authentification) -->
        <div id="roleSelectionArea" class="bg-gray-800 p-6 rounded-xl shadow-2xl mb-6 hidden">
            <h3 class="text-white text-xl font-semibold mb-4">Sélectionnez votre personnage :</h3>
            <div id="roleList" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                <!-- Les boutons de rôle seront insérés ici par JavaScript -->
            </div>
            <p class="text-gray-400 text-sm mt-4 text-center">Le rôle choisi apparaîtra à la place de la réplique pour vous guider.</p>
        </div>
        
        <!-- Zone 3: Répétition Principale (Visible après la sélection du rôle) -->
        <div id="rehearsalArea" class="line-container bg-gray-800 p-4 sm:p-6 rounded-xl shadow-2xl relative flex flex-col justify-center items-center text-center hidden">
            <p id="speaker" class="text-lg font-bold mb-3"></p>
            <p id="lineText" class="text-2xl font-semibold leading-relaxed"></p>
        </div>

        <!-- Zone 4: Boutons d'Action (Visible pendant la répétition) -->
        <div id="rehearsalActions" class="flex flex-col sm:flex-row justify-between gap-4 mt-6 hidden">
            
            <button id="backButton" onclick="goBack()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg sm:w-1/4 disabled:opacity-50 active:scale-95">
                Précédent
            </button>
            
            <button id="actionButton" onclick="handleAction()" class="user-prompt text-xl font-extrabold py-3 px-4 rounded-xl hover:bg-emerald-600 active:scale-95 shadow-xl sm:flex-grow">
                Continuer / Révéler
            </button>
            
            <button id="fullResetButton" onclick="showAuthArea()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg sm:w-1/4 active:scale-95">
                Changer de Rôle
            </button>
        </div>

        <!-- Message de Fin -->
        <p id="completionMessage" class="text-center text-green-400 text-2xl font-bold mt-10 hidden">
            FIN DE LA SCÈNE ! Bravo à tous !
        </p>
    </div>

    <script>
        // Rôle de l'utilisateur (sera défini après sélection)
        let YOUR_ROLE = null; 
        
        // Prénoms autorisés (en minuscules pour une vérification insensible à la casse)
        const AUTHORIZED_NAMES = ['christophe', 'maxime', 'lili', 'judith', 'soren', 'agathe', 'alexis', 'popovitch', 'béatrice', 'beatrice', 'petr-paul']; 

        // Rôles dans la pièce (déduits du script pour la sélection)
        const ALL_ROLES = ['MAXIME MAROIS', 'JUDITH MAROIS', 'PROFESSEUR POPOVITCH', 'AGATHE', 'FIN'];

        // Le script complet de la pièce
        const SCRIPT = [
            { speaker: 'MAXIME MAROIS', line: 'Snif! Comment tu fais pour manger comme ça alors que ma vie s\'écroule ?' },
            { speaker: 'JUDITH MAROIS', line: '(la bouche pleine.) Voyons, Maxime! Il y en a d\'autres filles sur la terre!' },
            { speaker: 'MAXIME MAROIS', line: '(se remettant à pleurer comme un bébé.) Oui, mais moi, c\'est Sandra que j\'aime, bon!' },
            { speaker: 'JUDITH MAROIS', line: 'Franchement, Maxime! Arrête de pleurer!' },
            { speaker: 'MAXIME MAROIS', line: 'Je peux pas, Judith! C\'est l\'acopa...l\'acapo... c\'est la fin du monde. Sandra, c\'était l\'amour de ma vie, la seule fille pour moi... pis elle me plante là pour un gars qui a une plus grosse collection de cartes de hockey que moi. C\'est épouvantable!' },
            { speaker: 'JUDITH MAROIS', line: '(sortant un très long mouchoir de sa poche.) Tiens. Mouche-toi là, pis... (Elle accroche un journal qui traînait sur la table. Maxime se mouche bruyamment et s\'essuie le nez et les yeux. Judith tend le journal à Maxime, très maternelle.) lis un peu. Ça va te changer les idées.' },
            { speaker: 'MAXIME MAROIS', line: '(prenant le journal et l\'ouvrant.) Judith! C\'est incroyable!' },
            { speaker: 'JUDITH MAROIS', line: 'Quoi ?' },
            { speaker: 'MAXIME MAROIS', line: 'Écoute: (Lisant.) «Polopopovitch: nouveau parfum bientôt disponible». (Retrouvant sa bonne humeur.) «Le savant professeur Petr-Paul (ou Petra-Paula) Popovitch, originaire de Yougoslavie, a mis au point un puissant parfum révolutionnaire pour homme qui permettra à tous les mâles humains de devenir irrésistibles à toutes les femmes et les filles. Le professeur Popovitch, qui opère un laboratoire dans la banlieue cossue de Pierkiroulnamasspamouss, termine les recherches sur sa nouvelle fragrance qui devrait se retrouver sur le marché avant la prochaine saison. Pour plus d\'informations, composez le 555-SENTBON.» (Relevant la tête vers Judith qui s\'est replongée dans son assiette.) Judith! Te rends-tu compte? Il faut que j\'appelle le professeur Pogo... Poto... (Regardant dans le journal.) Popovitch! C\'est la chance du siècle pour moi. Avec le parfum Gogo... Judo... (Regardant encore dans le journal.) Polopopovitch, peut-être que Sandra reviendrait...?' },
            { speaker: 'JUDITH MAROIS', line: '(la bouche pleine.) Cousin, arrête de penser à Sandra.' },
            { speaker: 'MAXIME MAROIS', line: 'Quoi?' },
            { speaker: 'JUDITH MAROIS', line: '(après avoir avalé.) J\'ai dit: Cousin, arrête de penser à Sandra.' },
            { speaker: 'MAXIME MAROIS', line: 'Impossible, Judith! Ce serait comme demander à un sardinier de pêcher des salmonidés.' },
            { speaker: 'JUDITH MAROIS', line: '(relevant la tête et s\'étouffant presque.) Quoi?' },
            { speaker: 'MAXIME MAROIS', line: 'Je vais téléphoner au professeur Photo... Tantôt... euh... Popovitch... tout de suite! (Il se dirige vers un téléphone public dans le coin du restaurant... ou prend l\'appareil de la cuisine.)' },
            { speaker: 'JUDITH MAROIS', line: '(découragée.) Pauvre Maxime! Ses oeufs vont être froids. (Elle secoue la tête.)' },
            { speaker: 'MAXIME MAROIS', line: '(terminant sa conversation au téléphone.) Merci, professeur Rolo... Bolo... Popovitch. J\'arrive dans le temps de le dire. (Il raccroche, exalté.) Tous mes problèmes sont réglés! (Il sort en courant. Le professeur Popovitch apparaît dans son laboratoire. Il fait des mélanges multicolores dans des éprouvettes. Ensuite, il lève une fiole au-dessus de sa tête et regarde son contenu avant de la passer sous son nez pour sentir.)' },
            { speaker: 'PROFESSEUR POPOVITCH', line: '(après avoir poussé un rire satanique.) Jé souis oune génie ! II né mé manqué plous qué cé méssiou Maxime pour connfirmer mes découvertes!' },
            { speaker: 'MAXIME MAROIS', line: '(entrant en courant dans le laboratoire, essoufflé.) Professeur Cromo... Sopo... Popovitch!' },
            { speaker: 'PROFESSEUR POPOVITCH', line: 'Méssiou Maxime, jé présoume?' },
            { speaker: 'MAXIME MAROIS', line: 'C\'est moi!' },
            { speaker: 'PROFESSEUR POPOVITCH', line: 'Fous n\'afez pas perdou dé temps.' },
            { speaker: 'MAXIME MAROIS', line: 'J\'étais pas loin. Deux transferts de métro, quatre autobus, 3.6 kilomètres de course et... me voilà !' },
            { speaker: 'PROFESSEUR POPOVITCH', line: 'Bien. Jé vé donc fous appliquer des échanntillonnes dé lé noufeau parfoume Polopopovitch qui fous rendra irrésistiboule aux femmes et aux filles.' },
            { speaker: 'MAXIME MAROIS', line: '(excité et fébrile.) Oui, oui, oui, allez-y! Je suis votre homme! (Changeant tout à coup d\'attitude, inquiet, reniflant, un peu dégoûté.) Qu\'est-ce que c\'est, cette odeur-là?' },
            { speaker: 'PROFESSEUR POPOVITCH', line: 'Cé l\'arôme irrésistiboule dé lé noufeau parfoume Polopopovitch, bienne soure!' },
            { speaker: 'MAXIME MAROIS', line: '(plaçant son nez au-dessus d\'une fiole.) Ouach! Qu\'est-ce que vous avez mis là-dedans ?' },
            { speaker: 'PROFESSEUR POPOVITCH', line: '(reprenant la fiole et la couvrant avec sa main.) Cé t\'une sécrète professionnel. Jé puis sélément fous dire qu\'il y a des herbes des plousiors plantes, des cendrés dou folcan Otstof, lé plous haut sommet dé la Yougoslafie et... dé l\'ail, beaucoup, beaucoup d\'ail!' },
            { speaker: 'MAXIME MAROIS', line: 'De l\'ail? Dans un parfum? Mais ça tient pas debout votre affaire! Je m\'en vais. (Il s\'apprête à sortir, mais il remarque que la porte - imaginaire - est verrouillée.)' },
            { speaker: 'PROFESSEUR POPOVITCH', line: 'Fou né poufez pas, méssiou Maxime. Fous faites parti dou processous d\'expérimanntationne.' },
            { speaker: 'MAXIME MAROIS', line: '(traumatisé.) Mais vous pouvez pas faire ça !' },
            { speaker: 'PROFESSEUR POPOVITCH', line: 'Né fous inquiètez pas, méssiou Maxime. Fous allez voir: toutés les femmes et les filles font souccomber à fos charmes.' },
            { speaker: 'MAXIME MAROIS', line: 'Avec un parfum à l\'ail? (doutant.)' },
            { speaker: 'PROFESSEUR POPOVITCH', line: 'Oui. Toutes les femmes et les filles adorent l\'odor dé l\'ail. Jé vé fous appliquer lé parfoume... (Il met du parfum à Maxime qui est repoussé par l\'odeur et se bouche le nez.)' },
            { speaker: 'MAXIME MAROIS', line: 'Ah! c\'est dégoûtant!' },
            { speaker: 'PROFESSEUR POPOVITCH', line: 'Mais non, méssiou Maxime. Fous allez foir. Les résoultats sont garantis! Maintenant, fous allez fous proméner dans la roue (rue) et toutés les femmes font sé rouer (ruer) sour fous.' },
            { speaker: 'MAXIME MAROIS', line: 'Toutes les folles vont me rouer de coups ?' },
            { speaker: 'PROFESSEUR POPOVITCH', line: 'Mais non! Toutes les femmes font sé rouer (ruer) sour fous.' },
            { speaker: 'MAXIME MAROIS', line: 'C\'est en plein ce que je disais! (Il soupire de découragement.) Moi qui croyais que tous mes problèmes amoureux disparaîtraient. J\'ai plutôt l\'impression que toutes mes chances de trouver l\'amour vont disparaître.' },
            { speaker: 'PROFESSEUR POPOVITCH', line: 'Rendez-fous ici à la fine dé la journée, méssiou Maxime.' },
            { speaker: 'MAXIME MAROIS', line: 'C\'est le cas de le dire. Ce parfum là va me rendre fou ! (Il sort, l\'air découragé. Il se rend au parc, marchant jusqu\'à un banc. Il s\'assoit, défait.) Ça marchera jamais, ce parfum-là! Ça sent le petit canard à la patte cassée. (Agathe, une très jolie fille, arrive dans le parc. Maxime l\'aperçoit au loin.) Wow! Je pense que j\'ai jamais vu une aussi belle fille de toute ma vie. Elle est encore plus belle que Sandra. Ah non! c\'est vrai! Je sens comme le fond du conteneur derrière un restaurant grec! (Agathe s\'approche de lui. Maxime tente de faire comme s\'il ne l\'avait pas vue. Étrange bruit d\'attirance chimique instantanée. Si on ne dispose pas d\'effet sonore, Agathe peut simuler l\'attirance par son attitude.)' },
            { speaker: 'AGATHE', line: '(s\'approchant de Maxime comme un aimant.) Bonjour, jeune homme irrésistible. Je m\'appelle Agathe. Et toi?' },
            { speaker: 'MAXIME MAROIS', line: 'Euh... Maxime. (En aparté.) Ça marche ?' },
            { speaker: 'AGATHE', line: '(s\'assoyant très près de Maxime.) Est-ce que tu viens souvent ici?' },
            { speaker: 'MAXIME MAROIS', line: 'Euh... pas tellement, non. Toi ?' },
            { speaker: 'AGATHE', line: 'Oui. Je viens écouter les oiseaux chanter, nourrir les écureuils et visiter le musée qui est tout près d\'ici.' },
            { speaker: 'MAXIME MAROIS', line: '(très heureux.) Un musée? Près d\'ici? Tu aimes les musées ?' },
            { speaker: 'AGATHE', line: 'J\'adore! Et souvent, je vais au magasin à côté acheter des cartes de hockey pour ma collection.' },
            { speaker: 'MAXIME MAROIS', line: 'Tu fais une collection de cartes de hockey ? C\'est extraordinaire! Moi aussi !' },
            { speaker: 'AGATHE', line: 'C\'est fantastique! Et tu sens tellement bon !' },
            { speaker: 'MAXIME MAROIS', line: 'Ah oui?' },
            { speaker: 'AGATHE', line: 'Oui! Est-ce que je peux t\'embrasser?' },
            { speaker: 'MAXIME MAROIS', line: '(heureux, mais surpris et un peu gêné.) Hein? Euh... oui, oui. (Ils s\'approchent pour s\'embrasser, mais au moment où leurs lèvres s\'apprêtent à se toucher, Judith arrive en courant.)' },
            { speaker: 'JUDITH MAROIS', line: 'Maxime! Enfin! Je te trouve! (Maxime et Agathe se tournent vers Judith. Maxime se lève et rejoint sa cousine, un peu contrarié.)' },
            { speaker: 'MAXIME MAROIS', line: 'Judith! Tu me déranges, là! (Tout heureux.) Le parfum du professeur Pipo... Copo... Popovitch fonctionne! Je pense que j\'ai rencontré la fille de ma vie! Agathe est tellement merveilleuse. Elle adore les musées, elle collectionne les cartes de hockey et elle est belle comme une déesse. C\'est fantastique!' },
            { speaker: 'JUDITH MAROIS', line: 'Voyons, Maxime! Tu la connais à peine. Tu vas quand même pas... (Même bruit d\'attirance chimique instantanée ou même attitude de Judith que celle d\'Agathe. Judith devient comme en transe, amoureuse.) Oh, Maxime! Tu es tellement beau! Est-ce que je peux t\'embrasser?' },
            { speaker: 'MAXIME MAROIS', line: '(surpris.) Quoi? Judith?' },
            { speaker: 'JUDITH MAROIS', line: 'Maxime! Tu es l\'homme de ma vie. Laisse-moi t\'embrasser sinon je mourrai de la pire peine d\'amour de l\'histoire de l\'humanité !' },
            { speaker: 'MAXIME MAROIS', line: 'Ben voyons, Judith! Je suis ton cousin! On peut pas s\'embrasser. As-tu perdu la boule?' },
            { speaker: 'JUDITH MAROIS', line: 'Non, Maxime. C\'est ton parfum. C\'est incroyable! Je ne peux plus te résister' },
            { speaker: 'MAXIME MAROIS', line: '(Se tournant vers le public, d\'abord surpris, puis terrorisé.) Ahhhhhh!!! Au secours!!! Professeur Bozo... Bongo... Popovitch!!! Faites quelque chose !(Il se sauve en courant à toute jambes. Judith le suit) À l\'aide!!!' },
            { speaker: 'JUDITH MAROIS', line: 'Non, Maxime ! Ne me quitte pas !' },
            { speaker: 'MAXIME MAROIS', line: 'Faut que j\'aille me laver, Judith ! Je pense que j\'aime mieux être un peu moins irrésistible ! Au secours !!! (Ils sortent en courant. Agathe reste seule.)' },
            { speaker: 'JUDITH MAROIS', line: 'Ne me quitte pas, Maxime!' },
            { speaker: 'AGATHE', line: 'Ben voyons ! Qu\'est-ce que je fais ici, moi ? (Elle hausse les épaules et sort, confuse.)' },
            { speaker: 'FIN', line: 'FIN' },
        ];

        let currentLineIndex = 0;
        let isRehearsing = false;
        let isWaitingForUser = false; 

        // Références aux éléments du DOM
        const firstNameInput = document.getElementById('firstNameInput');
        const authArea = document.getElementById('authArea');
        const authMessage = document.getElementById('authMessage');

        const roleSelectionArea = document.getElementById('roleSelectionArea');
        const roleList = document.getElementById('roleList');
        const currentRoleDisplay = document.getElementById('currentRoleDisplay');
        
        const rehearsalArea = document.getElementById('rehearsalArea');
        const speakerElement = document.getElementById('speaker');
        const lineTextElement = document.getElementById('lineText');
        
        const actionButton = document.getElementById('actionButton');
        const backButton = document.getElementById('backButton');
        const rehearsalActions = document.getElementById('rehearsalActions');
        const completionMessage = document.getElementById('completionMessage');
        const fullResetButton = document.getElementById('fullResetButton');

        /**
         * Affiche la zone d'authentification et réinitialise l'état.
         */
        function showAuthArea() {
            isRehearsing = false;
            currentLineIndex = 0;
            isWaitingForUser = false;
            YOUR_ROLE = null;

            // Afficher la zone d'authentification
            authArea.classList.remove('hidden');
            // Masquer les autres zones
            roleSelectionArea.classList.add('hidden');
            rehearsalArea.classList.add('hidden');
            rehearsalActions.classList.add('hidden');
            completionMessage.classList.add('hidden');

            // Mise à jour de l'affichage du rôle
            currentRoleDisplay.textContent = 'Rôle ciblé : Non sélectionné';
            fullResetButton.textContent = 'Changer de Rôle';
        }

        /**
         * Vérifie le prénom de l'utilisateur et affiche la sélection de rôle si autorisé.
         */
        function checkAuthorization() {
            const inputName = firstNameInput.value.trim().toLowerCase();
            
            if (AUTHORIZED_NAMES.includes(inputName)) {
                // Autorisé
                authMessage.classList.add('hidden');
                authArea.classList.add('hidden'); // Masquer l'authentification
                showRoleSelection(); // Afficher la sélection de rôle
            } else {
                // Non autorisé
                authMessage.textContent = 'Accès refusé. Vérifiez votre prénom.';
                authMessage.classList.remove('hidden');
            }
        }

        /**
         * Affiche la zone de sélection de rôle et génère les boutons.
         */
        function showRoleSelection() {
            roleSelectionArea.classList.remove('hidden');
            generateRoleButtons();
        }

        /**
         * Génère dynamiquement les boutons pour chaque rôle.
         */
        function generateRoleButtons() {
            roleList.innerHTML = ''; // Nettoyer les boutons précédents
            
            // Filtrer le rôle 'FIN' qui n'est pas un rôle jouable
            const playableRoles = ALL_ROLES.filter(role => role !== 'FIN');

            playableRoles.forEach(role => {
                const button = document.createElement('button');
                button.textContent = role;
                button.className = 'bg-gray-700 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-xl transition duration-150 shadow-md active:scale-95';
                button.onclick = () => selectRole(role);
                roleList.appendChild(button);
            });
        }

        /**
         * Sélectionne le rôle de l'utilisateur et démarre la répétition.
         * @param {string} role - Le rôle sélectionné.
         */
        function selectRole(role) {
            YOUR_ROLE = role;
            currentRoleDisplay.textContent = `Rôle ciblé : ${YOUR_ROLE}`;
            fullResetButton.textContent = 'Recommencer'; // Le bouton de reset devient "Recommencer"

            // Masquer la sélection de rôle
            roleSelectionArea.classList.add('hidden');
            
            startRehearsal(); // Démarre le processus de répétition
        }
        
        /**
         * Démarre le processus de répétition.
         */
        function startRehearsal() {
            if (!YOUR_ROLE) return; // Sécurité

            isRehearsing = true;
            currentLineIndex = 0;
            
            // Afficher la zone de répétition et les boutons d'action
            rehearsalArea.classList.remove('hidden');
            rehearsalActions.classList.remove('hidden');
            completionMessage.classList.add('hidden');
            
            nextLine();
        }

        /**
         * Met à jour l'état du bouton "Précédent" (désactivé si au début du script).
         */
        function updateBackButtonState() {
            // Désactiver le bouton si on est à la toute première ligne (index 0) ou la ligne suivante (index 1)
            backButton.disabled = currentLineIndex <= 1;
        }

        /**
         * Passe à la ligne suivante du script.
         */
        function nextLine() {
            if (!isRehearsing) return;

            // Vérifie si l'index pointe vers la fin du script
            if (currentLineIndex >= SCRIPT.length - 1) {
                // Gestion de la fin de la pièce
                rehearsalArea.classList.add('hidden');
                rehearsalActions.classList.add('hidden');
                completionMessage.classList.remove('hidden');
                isRehearsing = false;
                return;
            }

            const currentLine = SCRIPT[currentLineIndex];
            currentLineIndex++; // Incrémenter l'index pour la prochaine ligne

            // Nettoyer les classes de style précédentes
            lineTextElement.classList.remove('revealed-line');
            rehearsalArea.classList.remove('user-prompt', 'actor-line', 'revealed-line');
            speakerElement.classList.remove('text-gray-900', 'text-red-400', 'text-gray-900');
            lineTextElement.classList.remove('text-gray-900', 'text-white');
            
            isWaitingForUser = false;
            updateBackButtonState(); 

            if (currentLine.speaker === YOUR_ROLE) {
                // C'est la réplique de l'utilisateur
                isWaitingForUser = true;
                speakerElement.textContent = `Votre tour (${YOUR_ROLE})`;
                lineTextElement.textContent = 'Réciter votre réplique...';

                // Styles spécifiques pour l'utilisateur
                rehearsalArea.classList.add('user-prompt');
                speakerElement.classList.add('text-gray-900'); // Texte foncé sur fond vert
                lineTextElement.classList.add('text-gray-900');
                
                actionButton.textContent = 'À vous ! (Cliquez pour révéler)';
            } else {
                // C'est la réplique d'un autre personnage (partenaire)
                speakerElement.textContent = currentLine.speaker + ' dit :';
                lineTextElement.textContent = currentLine.line;

                // Styles spécifiques pour le partenaire
                rehearsalArea.classList.add('actor-line');
                speakerElement.classList.add('text-red-400'); // Texte rouge sur fond gris sombre
                lineTextElement.classList.add('text-white');
                
                actionButton.textContent = 'Continuer';
            }
        }

        /**
         * Gère le clic sur le bouton d'action (Continuer/Révéler).
         */
        function handleAction() {
            if (!isRehearsing) return;
            
            if (isWaitingForUser) {
                // Étape 1: L'utilisateur a cliqué pour voir sa réplique (Triche !)
                // currentLineIndex pointe sur la ligne *suivante*, donc on utilise index - 1 pour la ligne actuelle
                const previousLine = SCRIPT[currentLineIndex - 1]; 
                
                speakerElement.textContent = previousLine.speaker + ' (RÉVÉLÉ) :';
                lineTextElement.textContent = previousLine.line;
                
                // Appliquer les styles de révélation
                rehearsalArea.classList.remove('user-prompt', 'actor-line');
                rehearsalArea.classList.add('revealed-line'); // Utilise le style jaune
                speakerElement.classList.add('text-gray-900'); 
                lineTextElement.classList.add('text-gray-900');
                
                actionButton.textContent = 'Continuer la pièce';
                isWaitingForUser = false; // Prêt à passer à la ligne suivante
            } else {
                // Étape 2: L'utilisateur a lu la réplique du partenaire ou a vu la sienne, on passe à la suite.
                nextLine();
            }
        }
        
        /**
         * Retourne à la ligne précédente du script.
         */
        function goBack() {
            // Vérification de la répétition et de la position de l'index
            if (!isRehearsing || currentLineIndex <= 1) return;
            
            // On recule de 2 index pour se positionner sur la ligne à afficher, 
            currentLineIndex = currentLineIndex - 2; 
            
            // S'assurer que les zones sont visibles si l'on revenait de l'écran de fin
            completionMessage.classList.add('hidden');
            rehearsalArea.classList.remove('hidden');

            nextLine();
        }
        
        // Initialisation : Afficher la zone d'authentification au chargement.
        document.addEventListener('DOMContentLoaded', () => {
            showAuthArea(); 
            
            // Écoute l'appui sur 'Entrée' dans le champ de prénom pour valider
            firstNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkAuthorization();
                }
            });
        });
    </script>

</body>
</html>
